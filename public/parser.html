<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PiGraph - Dev page</title>

    <!-- Alpine -->
    <script src="//unpkg.com/alpinejs" defer></script>

    <!-- SVG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.0.13/svg.min.js"></script>

    <!-- KaTex -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
          integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq"
          crossorigin="anonymous">
    <script crossorigin="anonymous"
            integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
            src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- PiDraw -->
    <script src="../dev/pidraw.js"></script>

</head>
<body class="min-h-screen">
<div x-data="autoParse()">
    <h1 class="text-center text-2xl font-semibold my-10">Graph builder</h1>
    <div id="root" class=" max-w-xl mx-auto"></div>


    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-5 max-w-3xl mx-auto">
        <div class="flex flex-col">
            <div class="font-thin">Paramètres (xMin,xMax,yMin,yMax)</div>
            <input x-model="parameters" @input="modify" class=" px-2 py-3 mb-5 border rounded">

            <textarea
                x-model="construct"
                rows="10"
                class="border mx-3 md:mx-0 py-2 px-3 rounded"
                @input="build"
        ></textarea></div>
        <div class="px-3 md:px-0">
            <table class="w-full">
                <tr>
                    <td class="font-mono">A(4,6)</td>
                    <td class="font-thin">point</td>
                </tr>
                <tr>
                    <td class="font-mono">M=mid AB</td>
                    <td class="font-thin">milieu de A et B</td>
                </tr>
                <tr>
                    <td class="font-mono">d=AB</td>
                    <td class="font-thin">droite passant par A et B</td>
                </tr>
                <tr>
                    <td class="font-mono">a=[AB]</td>
                    <td class="font-thin">segment AB</td>
                </tr>
                <tr>
                    <td class="font-mono">a=[AB[</td>
                    <td class="font-thin">demi droite AB, ouverte en B</td>
                </tr>
                <tr>
                    <td class="font-mono">a=vAB</td>
                    <td class="font-thin">vecteur AB</td>
                </tr>
                <tr>
                    <td class="font-mono">p=perp d,A</td>
                    <td class="font-thin">perpendiculaire à d par A</td>
                </tr>
                <tr>
                    <td class="font-mono">p=para d,A</td>
                    <td class="font-thin">parallèle à d par A</td>
                </tr>
                <tr>
                    <td class="font-mono">p=circ A,2</td>
                    <td class="font-thin">cercle de centre A et de rayon 2</td>
                </tr>
                <tr>
                    <td class="font-mono">f(x)=3*x-5</td>
                    <td class="font-thin">Tracer une fonction y=f(x)</td>
                </tr>
                <tr>
                    <td class="font-mono">zone=fill f,g? a,b</td>
                    <td class="font-thin">Remplir l'espace entre deux fonctions, borné par a et b</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="text-center font-xs text-gray-300 mt-20 mb-5">Made with love (and some coffee) by B. Gass</div>
</div>
<script>
	function autoParse () {
		let graph = new PiDraw('root'),
            axis = graph.axis()

        let parser = graph.parse(``)

		return {
			figures: graph.figures.map(x => x.name),
			construct: '',
            parameters: '',
			build () {
				parser.update(this.construct)
			},
            modify() {
                // Get the parameters.
                let values = this.parameters.split(',')
                if(values.length===4){
                    let xMin = +values[0],
                        xMax = +values[1],
                        yMin = +values[2],
                        yMax = +values[3]


                    let pixelsPerUnitX = 800 / (Math.max(xMin, xMax)-Math.min(xMin, xMax))

                    console.log(pixelsPerUnitX)
                    graph.updateLayout({
                        xMin,
                        xMax,
                        yMin,
                        yMax,
                        pixelsPerUnit: pixelsPerUnitX
                    })
                    parser.update(this.construct, true)
                }
            }
		}
	}

</script>
</body>
</html>